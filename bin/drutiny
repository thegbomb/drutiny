#!/usr/bin/env php
<?php

use Drutiny\Kernel;
use Drutiny\Console\Application;

if (!in_array(PHP_SAPI, ['cli', 'phpdbg', 'embed'], true)) {
    echo 'Warning: The console should be invoked via the CLI version of PHP, not the '.PHP_SAPI.' SAPI'.PHP_EOL;
}

set_time_limit(0);

require dirname(__DIR__).'/vendor/autoload.php';

// $timezone = 'UTC';
//
// // Set the timezone to the local OS if supported.
// if (file_exists('/etc/localtime')) {
//   $systemZoneName = readlink('/etc/localtime');
//   if (strpos($systemZoneName, 'zoneinfo') !== FALSE) {
//     $timezone = substr($systemZoneName, strpos($systemZoneName, 'zoneinfo') + 9);
//   }
// }
//
// date_default_timezone_set($timezone);

const DRUTINY_LIB = '.';

$version_filename = dirname(__DIR__) . '/VERSION';
if (file_exists($version_filename)) {
  $version = file_get_contents($version_filename);
}
else {
  $version = exec(sprintf('git -C %s branch', dirname(__DIR__))) . '-dev';
}

$kernel = new Kernel('production');

$application = new Application($kernel, $version);
$application->run();
